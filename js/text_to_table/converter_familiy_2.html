<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <title>ПІБ Родовий відмінок (ВЕРХНІЙ РЕГІСТР)</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; max-width: 850px; margin: 30px auto; padding: 20px; background: #f4f7f9; }
        .container { background: white; padding: 30px; border-radius: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); }
        h2 { color: #2c3e50; border-bottom: 2px solid #3498db; padding-bottom: 10px; margin-top: 0; }
        .stats { background: #dff9fb; color: #130f40; padding: 12px; border-radius: 8px; margin-bottom: 20px; font-weight: bold; }
        textarea { width: 100%; height: 180px; border: 2px solid #dcdde1; border-radius: 8px; padding: 15px; font-size: 16px; margin-bottom: 20px; box-sizing: border-box; outline: none; transition: 0.3s; }
        textarea:focus { border-color: #3498db; }
        .btns { display: flex; gap: 12px; margin-bottom: 25px; }
        button { padding: 12px 25px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; font-size: 14px; transition: 0.3s; }
        .btn-process { background: #3498db; color: white; flex-grow: 2; }
        .btn-copy { background: #27ae60; color: white; flex-grow: 1; }
        .btn-clear { background: #e74c3c; color: white; }
        button:hover { filter: brightness(1.1); }
        .res-area { background: #f9f9f9; border: 1px dashed #bdc3c7; padding: 20px; min-height: 100px; white-space: pre-wrap; border-radius: 8px; font-family: 'Courier New', monospace; font-size: 16px; }
        .error-section { margin-top: 25px; background: #fee; border: 1px solid #fab1a0; padding: 15px; border-radius: 8px; color: #d63031; display: none; }
    </style>
</head>
<body>

<div class="container">
    <h2>Схилення ПІБ (Родовий відмінок)</h2>

    <div id="statsBox" class="stats">Рядків отримано: 0 | Оброблено успішно: 0</div>

    <textarea id="inputArea" placeholder="Введіть ПІБ українською мовою...&#10;заиграєв олексій володимирович&#10;шевченко тарас григорович"></textarea>

    <div class="btns">
        <button class="btn-process" onclick="runTransformation()">ОБРОБИТИ ДАНІ</button>
        <button class="btn-copy" onclick="copyResult()">СКОПІЮВАТИ</button>
        <button class="btn-clear" onclick="clearData()">ОЧИСТИТИ</button>
    </div>

    <div id="resultArea" class="res-area">Тут з'явиться результат у форматі: ПРІЗВИЩЕ Ім'я По батькові</div>

    <div id="errorSection" class="error-section">
        <strong>Не вдалося обробити:</strong>
        <div id="errorList" style="margin-top:10px; font-size: 14px;"></div>
    </div>
</div>

<script>
function capitalize(str) {
    if (!str) return "";
    return str.charAt(0).toUpperCase() + str.slice(1).toLowerCase();
}

function processRow(row) {
    // Нормалізація апострофа та очищення
    let clean = row.trim().replace(/['`‘’"“”]/g, "’");
    let parts = clean.split(/\s+/);
    
    if (parts.length < 3) return null;

    let [f, n, p] = parts;
    const pLow = p.toLowerCase();
    
    // Детекція статі
    const isFemale = pLow.endsWith('івна') || pLow.endsWith('івни');
    const gender = isFemale ? 'female' : 'male';

    // 1. По батькові (Родовий відмінок)
    if (gender === 'male' && pLow.endsWith('ович')) p = p.slice(0, -4) + 'овича';
    else if (gender === 'female' && pLow.endsWith('івна')) p = p.slice(0, -4) + 'івни';
    p = capitalize(p);

    // 2. Ім'я (Родовий відмінок)
    let nLow = n.toLowerCase();
    if (nLow === 'ілля') n = 'Іллі';
    else if (nLow === 'лев') n = 'Лева';
    else if (nLow.endsWith('ій')) n = n.slice(0, -2) + 'ія';
    else if (nLow.endsWith('я')) n = n.slice(0, -1) + 'і';
    else if (nLow.endsWith('о')) n = n.slice(0, -1) + 'а';
    else if (nLow.endsWith('а')) n = n.slice(0, -1) + 'и';
    else if (gender === 'male' && nLow.match(/[бвгґджзклмнпрстфхцчшщ]$/)) n += 'а';
    n = capitalize(n);

    // 3. Прізвище (Родовий + ВЕРХНІЙ РЕГІСТР)
    let fLow = f.toLowerCase();
    
    if (fLow.endsWith('ий') || fLow.endsWith('ій')) {
        f = (gender === 'male') ? f.slice(0, -2) + 'ого' : f.slice(0, -2) + 'ої';
    }
    else if (fLow.endsWith('а')) f = f.slice(0, -1) + 'и';
    else if (fLow.endsWith('я')) f = f.slice(0, -1) + 'і';
    else if (gender === 'male') {
        if (fLow.endsWith('о')) f = f.slice(0, -1) + 'а';
        else if (fLow.match(/[бвгґджзклмнпрстфхцчшщ]$/)) f += 'а';
    }
    
    f = f.toUpperCase(); // Прізвище завжди великими літерами

    return `${f} ${n} ${p}`;
}

function runTransformation() {
    const rawInput = document.getElementById('inputArea').value;
    const lines = rawInput.split('\n').filter(l => l.trim() !== '');
    
    let processed = [];
    let failed = [];

    lines.forEach(line => {
        let result = processRow(line);
        if (result) processed.push(result);
        else failed.push(line);
    });

    document.getElementById('resultArea').innerText = processed.join('\n');
    document.getElementById('statsBox').innerText = `Рядків отримано: ${lines.length} | Оброблено успішно: ${processed.length}`;

    const errSec = document.getElementById('errorSection');
    if (failed.length > 0) {
        errSec.style.display = 'block';
        document.getElementById('errorList').innerText = failed.join('\n');
    } else {
        errSec.style.display = 'none';
    }
}

function copyResult() {
    const text = document.getElementById('resultArea').innerText;
    if (text) {
        navigator.clipboard.writeText(text);
        alert('Результат скопійовано!');
    }
}

function clearData() {
    document.getElementById('inputArea').value = '';
    document.getElementById('resultArea').innerText = "Тут з'явиться результат у форматі: ПРІЗВИЩЕ Ім'я По батькові";
    document.getElementById('statsBox').innerText = 'Рядків отримано: 0 | Оброблено успішно: 0';
    document.getElementById('errorSection').style.display = 'none';
}
</script>

</body>
</html>